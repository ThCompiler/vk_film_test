# Тестовое задание вакансии "Go-разработчик" в VK

## Задание;

Необходимо разработать бэкенд приложения “Фильмотека”, который предоставляет REST API для управления базой данных фильмов.

## Функциональные возможности;

Приложение должно поддерживать следующие функции:

* добавление информации об актёре (имя, пол, дата рождения),
* изменение информации об актёре.

Возможно изменить любую информацию об актёре, как частично, так и полностью:

* удаление информации об актёре,
* добавление информации о фильме.

При добавлении фильма указываются его название (не менее 1 и не более 150 символов), описание (не более 1000 символов), дата выпуска, рейтинг (от 0 до 10) и список актёров:

* изменение информации о фильме.

Возможно изменить любую информацию о фильме, как частично, так и полностью:

* удаление информации о фильме,
* получение списка фильмов с возможностью сортировки по названию, по рейтингу, по дате выпуска. По умолчанию используется сортировка по рейтингу (по убыванию),
* поиск фильма по фрагменту названия, по фрагменту имени актёра,
* получение списка актёров, для каждого актёра выдаётся также список фильмов с его участием,
* API должен быть закрыт авторизацией,
* поддерживаются две роли пользователей - обычный пользователь и администратор. Обычный пользователь имеет доступ только на получение данных и поиск, администратор - на все действия. Для упрощения можно считать, что соответствие пользователей и ролей задаётся вручную (например, напрямую через БД).

## Требования к реализации:

* язык реализации - `go`,
* для хранения данных используется реляционная СУБД (предпочтительно - `PostgreSQL`),
* предоставлена спецификация на API (в формате `Swagger 2.0` или `OpenAPI 3.0`).

Бонус: используется подход api-first (генерация кода из спецификации) или code-first (генерация спецификации из кода).

* Для реализации http сервера разрешается использовать только стандартную библиотеку http (без фреймворков).
* Логирование - в лог должна попадать базовая информация об обрабатываемых запросах, ошибки.
* Код приложения покрыт юнит-тестами не менее чем на 70%.
* `Dokerfile` для сборки образа.
* `Docker-compose` файл для запуска окружения с работающим приложением и СУБД.

## Инструкция по запуску:

Для работы со всеми методами API, кроме Login, необходимо сначала авторизоваться. 
По умолчанию в системе есть пользователь `admin` с паролем `admin` и ролью `admin` и
пользователь `user` с паролем `qwerty` с ролью `user`. 

Для роли `user` доступны только запросы с методом `GET`. Для роли `admin` доступны все методы API.

В качестве авторизации для работы с API используется сохранение сессий в cookies.

### Запуск

#### Конфигурационный файл

В качестве примера конфигурационный файл находится в корне репозитория с название 'config.yaml'.
Его формат выглядит следующим образом:
```yaml
port: 8080 # Порт на котором запускается сервер
postgres:
  url: "host=films-bd port=5432 user=films password=qwerty dbname=films sslmode=disable" # Строка подключения к базе Postgres
redis:
  url: "redis://sessions/0" # Строка подключения к базе Redis для хранения сессий
logger:  # Настройки логгера
  app_name: "vk_films"        # Имя приложения, будет выводиться в лог
  level: 'debug'              # Минимальный уровень вывода информации в лог
  directory: './app-log/'     # Папка куда сохранять логи
  use_std_and_file: true      # Если установлено в true, то лог будет выводиться как в файл так и в stdErr
  allow_show_low_level: true  # Если установлено в true и use_std_and_file тоже true, то в stdErr будет выводиться лог всех уровней
```

#### Сборка контейнера с сервером

Перед запуском необходимо собрать Docker образ:

```cmd
sudo make build-docker
```

#### Запуск всей системы

Для запуска всей системы можно выполнить команду с выводом информации в консоль:

```cmd
sudo make run-verbose
```

Или команду которая запускает docker compose в режиме daemon:

```cmd
sudo make run
```

Система запущена.

